---
phase: 04-product-demo
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - components/sections/ProductDemo.tsx
  - app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Demo section pins and sidebar walkthrough animates as user scrolls through pinned area"
    - "Bento cards stagger-reveal with fade+scale as section enters viewport"
    - "Parallax background shapes move at different speeds creating depth"
    - "Demo content fades in as section enters viewport (heading area)"
    - "Reduced motion users see all content statically with no broken layout"
    - "ProductDemo replaces placeholder section in page.tsx"
  artifacts:
    - path: "components/sections/ProductDemo.tsx"
      provides: "Complete ProductDemo with GSAP ScrollTrigger animations"
      contains: "useGSAP"
    - path: "app/page.tsx"
      provides: "Homepage with ProductDemo integrated"
      contains: "import ProductDemo"
  key_links:
    - from: "components/sections/ProductDemo.tsx"
      to: "gsap/ScrollTrigger"
      via: "useGSAP hook with pin + scrub timeline"
      pattern: "scrollTrigger.*pin.*true"
    - from: "components/sections/ProductDemo.tsx"
      to: "gsap.matchMedia"
      via: "reduced motion support wrapping all animations"
      pattern: "matchMedia.*prefers-reduced-motion"
    - from: "app/page.tsx"
      to: "components/sections/ProductDemo.tsx"
      via: "import and render in homepage"
      pattern: "import ProductDemo"
    - from: "components/sections/ProductDemo.tsx"
      to: ".parallax-shape elements"
      via: "GSAP yPercent scrub parallax"
      pattern: "yPercent.*parallax"
    - from: "components/sections/ProductDemo.tsx"
      to: ".demo-card elements"
      via: "GSAP ScrollTrigger.batch stagger reveal"
      pattern: "ScrollTrigger\\.batch|stagger.*demo-card"
---

<objective>
Add scroll-driven animations to ProductDemo and integrate it into the homepage. This includes: GSAP ScrollTrigger pinning with a sidebar walkthrough timeline (chat bubbles appear sequentially as user scrolls), staggered bento card reveals, parallax background shapes, fade-in heading, and reduced motion fallback.

Purpose: Transform the static bento layout from Plan 01 into a dynamic, scroll-driven experience that matches Square's bold animation aesthetic. The pinned sidebar walkthrough is the hero animation of this section -- it shows Slider in action as users scroll, creating an "aha moment" that drives waitlist signups.

Output: ProductDemo.tsx updated with full GSAP animations, page.tsx updated to render ProductDemo replacing the placeholder demo section.
</objective>

<execution_context>
@C:\Users\antoi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\antoi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-product-demo/04-RESEARCH.md
@.planning/phases/04-product-demo/04-01-SUMMARY.md (plan 01 output -- component structure)
@components/sections/ProductDemo.tsx (created in Plan 01, will be modified)
@components/sections/FeatureShowcase.tsx (established ScrollTrigger pin+scrub pattern to follow)
@components/sections/Hero.tsx (fade-in animation pattern to reuse)
@components/providers/SmoothScrollProvider.tsx (Lenis+GSAP bridge already set up)
@app/page.tsx (replace placeholder demo section)
@app/globals.css (design tokens)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GSAP scroll animations to ProductDemo</name>
  <files>components/sections/ProductDemo.tsx</files>
  <action>
Modify ProductDemo.tsx to add all scroll-driven animations. The component is already 'use client' from Plan 01. Add GSAP imports and animation logic:

**Imports to add:**
```typescript
import { useGSAP } from '@gsap/react'
import gsap from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'

gsap.registerPlugin(ScrollTrigger)
```

**Refs to add:**
- `containerRef` on the outer section (pin target for sidebar walkthrough)
- `gridRef` on the bento grid container
- `headingRef` on the heading area

**Animation structure** -- All wrapped in `useGSAP(() => { ... }, { scope: containerRef })` with `gsap.matchMedia()` for reduced motion:

Inside `mm.add("(prefers-reduced-motion: no-preference)", () => { ... })`:

**1. Heading fade-in (non-pinned, trigger-based):**
```typescript
gsap.from(headingRef.current, {
  autoAlpha: 0,
  y: 40,
  duration: 0.8,
  ease: 'power2.out',
  scrollTrigger: {
    trigger: headingRef.current,
    start: 'top 85%',
    toggleActions: 'play none none none',
  }
})
```

**2. Bento card staggered reveal (non-pinned, trigger-based):**
Use `ScrollTrigger.batch()` for efficient staggered reveals on `.demo-card` elements:
```typescript
ScrollTrigger.batch('.demo-card', {
  onEnter: (elements) => {
    gsap.from(elements, {
      autoAlpha: 0,
      y: 60,
      scale: 0.95,
      duration: 0.8,
      stagger: 0.15,
      ease: 'power2.out',
    })
  },
  start: 'top 85%',
  once: true,  // Only play once
})
```

**3. Sidebar walkthrough timeline (pinned, scrub):**
This is the centerpiece animation. Pin the DemoFrame card area and scrub through a timeline that animates the sidebar chat bubbles sequentially.

Target the large DemoFrame card (the first bento card, with `data-step="sidebar-walkthrough"`). Create a wrapper element around the DemoFrame content area specifically for pinning -- add a `demo-walkthrough-pin` class on a wrapper div that contains just the DemoFrame. This wrapper will be the pin target.

```typescript
const walkthrough = containerRef.current?.querySelector('[data-step="sidebar-walkthrough"]')
const chatBubbles = containerRef.current?.querySelectorAll('.demo-chat-bubble')

if (walkthrough && chatBubbles && chatBubbles.length > 0) {
  const tl = gsap.timeline({
    scrollTrigger: {
      trigger: walkthrough,
      pin: true,
      scrub: 0.5,
      start: 'top 20%',  // Pin when DemoFrame is 20% from top
      end: () => `+=${chatBubbles.length * 80}vh`,  // Dynamic based on bubble count
      invalidateOnRefresh: true,
      pinSpacing: true,
    }
  })

  // Initially hide all chat bubbles
  gsap.set(chatBubbles, { autoAlpha: 0, y: 20 })

  // Sequentially reveal each chat bubble as user scrolls
  chatBubbles.forEach((bubble, index) => {
    tl.to(bubble, {
      autoAlpha: 1,
      y: 0,
      duration: 1,
      ease: 'power2.out',
    })
    // Add a pause between bubbles (hold time)
    if (index < chatBubbles.length - 1) {
      tl.to({}, { duration: 0.5 })  // Empty tween as spacer
    }
  })
}
```

IMPORTANT considerations for the pinning:
- Do NOT pin the entire section -- only pin the walkthrough card area. The rest of the bento cards should scroll normally.
- The pin target must have explicit dimensions (the DemoFrame card should have a fixed height during pinning)
- After the walkthrough completes, the pin releases and normal scrolling continues through the remaining bento cards
- If pinning a single bento card proves too complex (layout issues with CSS Grid), fall back to pinning a dedicated wrapper div that sits above the grid, containing just the DemoFrame. In this case, restructure the layout: heading -> DemoFrame walkthrough (pinned) -> bento grid of smaller cards below.

**Alternative layout approach (simpler, recommended):** Instead of pinning one card within the grid (which causes CSS Grid layout issues), structure the section as:
1. Heading area (fade-in)
2. DemoFrame walkthrough area (full-width, pinned with chat bubble timeline)
3. Bento grid of supporting cards below (stagger reveal, NOT pinned)

This is cleaner because pinning within a CSS Grid cell is fragile. The DemoFrame gets prominent full-width placement (like Square's hero product shots), and the smaller bento cards below show supporting aspects.

**4. Parallax background shapes:**
```typescript
gsap.utils.toArray<HTMLElement>('.parallax-shape').forEach((shape, i) => {
  gsap.to(shape, {
    yPercent: 30 + (i * 20),  // Different speeds for depth
    ease: 'none',
    scrollTrigger: {
      trigger: containerRef.current,
      start: 'top bottom',
      end: 'bottom top',
      scrub: true,  // Direct link for parallax (not 0.5)
    }
  })
})
```

**Reduced motion fallback** -- Inside `mm.add("(prefers-reduced-motion: reduce)", () => { ... })`:
```typescript
// Show all elements without animation
gsap.set('.demo-card', { clearProps: 'all' })
gsap.set('.demo-chat-bubble', { clearProps: 'all' })
// No pinning, no parallax
```

**Return cleanup:** `return () => mm.revert()`

**Structural adjustment needed in the JSX:**
If using the alternative layout approach (recommended), restructure the ProductDemo JSX:
1. Move the DemoFrame out of the bento grid and into its own full-width wrapper between heading and grid
2. Add `demo-chat-bubble` class to each sidebar message bubble for GSAP targeting
3. Ensure the DemoFrame wrapper has `will-change-transform` for pin performance
4. The bento grid below only contains the 3 smaller cards (steps 2-4)

This adjustment to Plan 01's structure is acceptable because Plan 01 created the components but Plan 02 wires the final layout with animation requirements driving structure.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no TypeScript errors. Check that:
1. ProductDemo imports useGSAP, gsap, ScrollTrigger
2. gsap.registerPlugin(ScrollTrigger) is called at module level
3. useGSAP wraps all animations with scope: containerRef
4. gsap.matchMedia() wraps animation code with no-preference and reduce branches
5. ScrollTrigger pin config uses function-based end value with invalidateOnRefresh
6. Parallax uses scrub: true (not 0.5)
7. Cleanup returns mm.revert()
  </verify>
  <done>
ProductDemo.tsx has four animation layers: (1) heading fade-in on viewport entry, (2) bento card stagger reveal with scale+fade, (3) pinned DemoFrame with scrubbed sidebar chat bubble timeline, (4) parallax background shapes. All animations wrapped in matchMedia with reduced motion fallback. Cleanup handled by useGSAP context.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ProductDemo into homepage</name>
  <files>app/page.tsx</files>
  <action>
Update app/page.tsx to:

1. **Add import:** `import ProductDemo from '@/components/sections/ProductDemo'`

2. **Replace the placeholder demo section** (lines 13-25, the `<section id="demo">` block with "Interactive demo placeholder") with:
```tsx
<ProductDemo />
```

3. **Verify the section order remains correct:** Hero -> FeatureShowcase -> ProductDemo -> Skills -> Use Cases -> CTA

4. **Do NOT** change any other sections. Only replace the demo placeholder.

5. The ProductDemo component already has `id="demo"` internally so the navbar scroll link to #demo will still work.

After the edit, the page.tsx imports should include: Hero, FeatureShowcase, ProductDemo, Button, Card.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm page.tsx compiles. Run `npm run build` (or `npx next build`) to verify the full build succeeds. Check that the import path resolves correctly. Verify section order in the rendered HTML: hero -> features -> demo -> skills -> use-cases -> cta.
  </verify>
  <done>
page.tsx imports and renders ProductDemo between FeatureShowcase and Skills section. The placeholder demo section is completely replaced. The #demo anchor still works for navbar navigation. Full build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Product Demo section with:
- Square-inspired bento grid layout with varying card sizes
- Cursor-following flashlight border effect on bento cards (hover to see)
- PowerPoint chrome frame mockup with animated sidebar walkthrough
- Chat bubbles appear sequentially as you scroll through the pinned area
- Parallax background elements adding depth
- Staggered card reveal animations
- Reduced motion support
  </what-built>
  <how-to-verify>
1. Run `npm run dev` and open http://localhost:3000
2. Scroll down past Feature Showcase to reach the Demo section
3. Verify the heading fades in as you approach the section
4. Verify the DemoFrame (PowerPoint mockup) pins and chat bubbles animate in sequentially as you scroll
5. After the walkthrough completes, verify normal scroll resumes through the bento cards below
6. Hover over bento cards -- you should see a burnt-orange flashlight/glow effect following your cursor near the card border
7. Verify the bento cards stagger in with fade + subtle scale animation
8. Check parallax: decorative blurred shapes in background should move slower than content
9. Resize browser to mobile width -- verify layout adapts (single column, no broken overflow)
10. Test reduced motion: Enable "Reduce motion" in OS accessibility settings, reload page, verify all content is visible without animation and no broken layout
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual/interaction issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` completes successfully
3. Dev server shows ProductDemo section between FeatureShowcase and Skills
4. Scroll-driven sidebar walkthrough pins and animates chat bubbles sequentially
5. Bento cards have cursor flashlight effect on hover
6. Staggered card reveals trigger on viewport entry
7. Parallax shapes move at different speeds from content
8. Heading fades in on scroll
9. Reduced motion: all content visible, no animations, no layout breakage
10. Mobile responsive: single column layout, proper spacing
11. No console errors or ScrollTrigger warnings
12. Existing FeatureShowcase pin still works correctly (no pin order issues -- demo section is after features in DOM order, which is correct)
</verification>

<success_criteria>
- ProductDemo section is live on the homepage with all animations working
- Sidebar walkthrough is the centerpiece: pins, chat bubbles animate sequentially on scroll, then releases
- Bento cards stagger-reveal on viewport entry
- Cursor flashlight effect visible on card hover
- Parallax background adds depth without being distracting
- Responsive layout works at all breakpoints
- Reduced motion fully supported
- No regression on existing sections (Hero, FeatureShowcase, navbar)
- Page build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-product-demo/04-02-SUMMARY.md`
</output>
